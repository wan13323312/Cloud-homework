
# 知识图谱构建Agent接口描述文档
## 1. 接口基本信息
| 字段         | 说明                                             |
|--------------|------------------------------------------------|
| 接口名称     | 跨学科知识图谱自动构建接口                                  |
| 接口路径     | `/api/kg/build`                                |
| 请求方法     | POST                                           |
| 接口描述     | 输入学科概念，自动校验有效性、查询已有关联、扩展跨学科新关联、校验合理性、保存并生成知识图谱 |
| 响应格式     | JSON                                           |
| 接口版本     | v1.0                                           |
| 超时时间     | 300s（因包含LLM调用+数据库操作，建议设置较长超时）                  |

## 2. 请求参数说明
### 2.1 请求头（Header）
| 参数名       | 必选 | 类型   | 说明                     | 示例值               |
|--------------|------|--------|--------------------------|----------------------|
| Content-Type | 是   | string | 请求体格式               | application/json     |
| Accept       | 是   | string | 响应格式                 | application/json     |

### 2.2 请求体（Body）
| 参数名   | 必选 | 类型   | 说明                                                                 | 示例值 |
|----------|------|--------|----------------------------------------------------------------------|--------|
| concept  | 是   | string | 待构建图谱的核心学科概念<br/>- 仅支持中文/英文/数字/常见学科符号<br/>- 需为具体学科概念（如“熵”“神经网络”） | 熵     |

### 2.3 请求示例
```json
{
  "concept": "熵"
}
```

## 3. 响应参数说明
### 3.1 响应状态码
| 状态码 | 说明                     | 场景示例                                   |
|--------|--------------------------|--------------------------------------------|
| 200    | 成功                     | 概念有效，图谱构建完成                     |
| 400    | 输入参数无效             | 概念包含非法字符/无意义词汇（如“测试123”） |
| 500    | 服务器内部错误           | LLM调用失败/数据库连接异常                 |

### 3.2 响应体字段
| 一级字段     | 类型   | 说明                     | 二级字段                  | 类型    | 说明                                                                 |
|--------------|--------|--------------------------|---------------------------|---------|----------------------------------------------------------------------|
| code         | int    | 响应状态码               | -                         | -       | 200/400/500                                                          |
| msg          | string | 响应信息                 | -                         | -       | 成功/失败提示信息                                                    |
| data         | object | 核心返回数据（200时返回） | nodes                     | array   | 知识图谱节点列表                                                     |
| -            | -      | -                        | nodes[].name              | string  | 节点名称（概念名）                                                   |
| -            | -      | -                        | nodes[].domain            | string  | 节点所属领域（如“物理”“计算机”“未知”）                              |
| -            | -      | -                        | links                     | array   | 知识图谱关联边列表                                                   |
| -            | -      | -                        | links[].source            | string  | 源节点（核心概念）                                                   |
| -            | -      | -                        | links[].target            | string  | 目标节点（关联概念）                                                 |
| -            | -      | -                        | links[].relation          | string  | 关联逻辑描述（具体科学依据）                                         |
| -            | -      | -                        | links[].strength          | int     | 关联强度（1-5，越高相关性越强）                                      |
| -            | -      | -                        | reasoning                 | array   | Agent推理过程日志（分步记录）                                        |
| -            | -      | -                        | cleaned_relations         | array   | 清理的不合理旧关联列表                                               |
| error        | string | 错误详情（非200时返回）  | -                         | -       | 具体错误原因（如“概念包含非法字符”）                                 |

### 3.3 响应示例
#### 3.3.1 成功响应（200）
```json
{
  "code": 200,
  "msg": "知识图谱构建成功",
  "data": {
    "nodes": [
      {"name": "熵", "domain": "未知"},
      {"name": "信息熵", "domain": "计算机"},
      {"name": "吉布斯自由能", "domain": "化学"},
      {"name": "社会熵", "domain": "社会学"},
      {"name": "热力学第二定律", "domain": "物理"},
      {"name": "玻尔兹曼熵公式", "domain": "数学/物理"},
      {"name": "代谢熵产生", "domain": "生物"}
    ],
    "links": [
      {
        "source": "熵",
        "target": "信息熵",
        "relation": "热力学熵描述了系统微观状态混乱度的统计物理量，而信息熵是克劳德·香农借鉴此概念，用于量化信息源的不确定性或信息量。两者在数学形式上具有同构性（都满足概率的负对数期望），使得统计物理和信息论之间建立了深刻的桥梁。",
        "strength": 5
      },
      {
        "source": "熵",
        "target": "吉布斯自由能",
        "relation": "吉布斯自由能（G）的定义式为 G = H - TS，其中T是温度，S是系统的熵。该公式明确地将能量（焓H）与无序度（熵S）结合起来，揭示了化学反应的自发性不仅取决于能量降低（焓减），也取决于熵增的驱动。",
        "strength": 4
      },
      {
        "source": "熵",
        "target": "社会熵",
        "relation": "社会学家将熵的概念引入对社会系统的分析，认为一个封闭、缺乏信息交流与能量输入的社会系统，其内部冲突、失序和不确定性（社会熵）会自发增加，这与热力学孤立系统的熵增原理在逻辑上具有类比性。",
        "strength": 3
      },
      {
        "source": "熵",
        "target": "热力学第二定律",
        "relation": "熵是热力学第二定律的核心物理量，用于量化系统的无序程度和过程的方向性。该定律通过熵增原理，将熵的概念与时间箭头、能量耗散及不可逆过程紧密联系在一起，是熵在物理学中最根本的体现。",
        "strength": 5
      },
      {
        "source": "熵",
        "target": "玻尔兹曼熵公式",
        "relation": "该公式为熵提供了统计力学的微观解释，将宏观的、唯象的热力学熵与系统微观粒子可能排列方式的数量（即混乱度）建立了定量桥梁。它表明熵本质上是系统微观状态不确定性的度量，是连接宏观与微观物理世界的关键。",
        "strength": 5
      },
      {
        "source": "熵",
        "target": "代谢熵产生",
        "relation": "生命体作为开放系统，通过从环境摄取低熵物质（如有序的有机物）并向环境排出高熵废物（如热量和简单分子），来抵消自身内部因代谢活动产生的熵增，从而维持低熵有序状态。这体现了熵概念在解释生命系统远离平衡态、对抗热力学衰败这一核心特征中的应用。",
        "strength": 4
      }
    ],
    "reasoning": [
      "0. 输入校验：开始调用validate_concept工具判断概念有效性",
      "0. 输入校验通过：熵是热力学/信息论核心学科概念，具有明确科学定义和研究价值",
      "1. 查库：获取熵的已有关联",
      "2. 清理旧关联：共处理0个不合理关联（软删除/标记异常）",
      "3. 扩展（第1次）：开始生成新关联",
      "3. 扩展（第1次）：生成5个新关联（跨学科、非重复）",
      "4. 校验：5个关联合法，0个关联不合法",
      "5. 存库：保存5个合法关联",
      "6. 生成图谱：共7个节点，6条合法关联"
    ],
    "cleaned_relations": []
  }
}
```

#### 3.3.2 失败响应（400）
```json
{
  "code": 400,
  "msg": "输入概念无效",
  "error": "概念「测试123」无效：无意义词汇，仅支持具体的学科概念（如“熵”“神经网络”）"
}
```

#### 3.3.3 失败响应（500）
```json
{
  "code": 500,
  "msg": "服务器内部错误",
  "error": "LLM调用超时：无法连接到大模型服务"
}
```

## 4. 接口调用注意事项
1. **参数限制**：`concept`参数长度建议≤50字符，仅支持中文/英文/数字/常见学科符号（α、β、∑、∏等）；
2. **频率限制**：因包含LLM调用和数据库操作，建议接口调用频率≤10次/分钟；
3. **依赖说明**：接口依赖Neo4j数据库（存储知识图谱）、大模型服务（LLM，用于关联扩展/校验），需确保依赖服务正常运行；
4. **重试机制**：接口内部已实现关联扩展重试（最多3次），外部无需额外重试；
5. **数据持久化**：扩展的合法关联会自动保存到Neo4j数据库，后续调用同一概念时会复用已有合法关联。

## 5. 接口核心能力说明
| 能力点               | 说明                                                                 |
|----------------------|----------------------------------------------------------------------|
| 输入智能校验         | 基于LLM语义判断概念有效性，而非硬编码规则，支持灵活的学科概念校验     |
| 跨学科关联扩展       | 自动生成5个不同领域的跨学科关联，避免重复，基于客观科学知识           |
| 关联合理性校验       | 反幻觉设计，校验关联逻辑的科学性，过滤编造/无依据的关联               |
| 旧关联清理           | 自动清理数据库中不合理的旧关联（软删除/标记异常），保证图谱质量       |
| 可解释性             | 完整的推理日志，可追溯图谱构建的每一步过程                           |
